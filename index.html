<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Quiz interativo para estudo de Direito Constitucional e Regimento Interno da Câmara dos Deputados">
    <title>Quiz Câmara dos Deputados</title>
    <!-- Social Meta Tags -->
    <meta property="og:title" content="Quiz Câmara dos Deputados">
    <meta property="og:description"
        content="Prepare-se para o concurso da Câmara! Teste seus conhecimentos em Direito Constitucional e Regimento Interno neste quiz interativo.">
    <meta property="og:url" content="https://quiz-camara.netlify.app/"> <!-- Placeholder URL -->
    <meta property="og:type" content="website">
    <meta name="theme-color" content="#1a3a52">
    <!-- Netlify Identity Widget -->
    <script type="text/javascript" src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #1e2838;
            font-family: 'Poppins', Arial, sans-serif;
            color: #ffffff;
        }

        #game-container {
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>

<body>
    <div id="game-wrapper" style="position: relative; width: fit-content; margin: auto;">
        <!-- Auth Header -->
        <div id="auth-header"
            style="position: absolute; top: 10px; right: 10px; z-index: 1000; display: flex; align-items: center; gap: 10px;">
            <span id="user-display"
                style="color: #ffffff; text-shadow: 0 1px 2px black; font-family: 'Poppins'; font-size: 14px; display: none;"></span>
            <button id="login-btn" onclick="netlifyIdentity.open()" style="
                background: rgba(0,0,0,0.6); border: 1px solid #d4af37; color: #d4af37; 
                padding: 5px 15px; border-radius: 20px; cursor: pointer; font-family: 'Poppins'; font-size: 12px;
                transition: all 0.2s;">
                Login / Signup
            </button>
            <button id="logout-btn" onclick="netlifyIdentity.logout()" style="
                background: rgba(192, 57, 43, 0.6); border: 1px solid #c0392b; color: #ffffff; 
                padding: 5px 15px; border-radius: 20px; cursor: pointer; font-family: 'Poppins'; font-size: 12px;
                display: none;">
                Sair
            </button>
        </div>

        <div id="game-container"></div>
    </div>

    <!-- questions.js is now imported as a module -->

    <script>
        // Netlify Identity Logic
        document.addEventListener("DOMContentLoaded", () => {
            const user = netlifyIdentity.currentUser();
            updateAuthUI(user);

            netlifyIdentity.on("login", user => {
                console.log("Login", user);
                netlifyIdentity.close();
                updateAuthUI(user);
                window.location.reload(); // Reload to refresh permissions/UI
            });

            netlifyIdentity.on("logout", () => {
                console.log("Logged out");
                updateAuthUI(null);
                window.location.reload();
            });
        });

        function updateAuthUI(user) {
            const loginBtn = document.getElementById('login-btn');
            const logoutBtn = document.getElementById('logout-btn');
            const userDisplay = document.getElementById('user-display');

            if (user) {
                loginBtn.style.display = 'none';
                logoutBtn.style.display = 'block';
                userDisplay.style.display = 'block';
                userDisplay.textContent = `Olá, ${user.user_metadata.full_name || user.email}`;

                // Generate token for API calls
                user.jwt().then(token => {
                    localStorage.setItem('netlify_token', token);
                });

            } else {
                loginBtn.style.display = 'block';
                logoutBtn.style.display = 'none';
                userDisplay.style.display = 'none';
                localStorage.removeItem('netlify_token');
            }
        }
    </script>

    <script type="module" src="game.js"></script>

</body>

</html>